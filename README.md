Домашнее задание № 8. Закиров Андрей

Дисциплина: Программирование на Python

Тема: Взаимодействие в WWW: взаимодействие с сервисами

Этап 1. Изучение Scapy 

•	Изучены основы работы с Scapy по документации (структура пакетов, перехват трафика, фильтрация по протоколам).

•	Настроено окружение для работы со скриптом scapy, временно отключены RST-пакеты командой:

sudo iptables -A OUTPUT -p tcp --tcp-flags RST RST -j DROP


Этап 2. Анализ трафика 
•	Проведено ознакомление с инструментом Google Gruyere и он запущен по адресу:
http://google-gruyere.appspot.com/408086229062912822940580099856782328160/
•	HTTP-ответы сервера сжаты (gzip), функция анализа в скрипте доработана для корректного отображения содержимого ответа.
Взаимодействуем с сайтом (переходы по страницам, отправка форм,
ввод данных), фиксируя трафик.
 Проанализируем перехваченные HTTP-запросы и ответы:
– метод запроса (GET / POST);
– URL и параметры;
– заголовки;
– тело запроса и ответа

Для запуска воспользуемся командой:

$ sudo python3 scapy_xss_analyzer.py --capture google-gruyere.appspot.com --timeout 20 --output traffic1.pcap

Пример ответа 1 сохранен в файле traffic1.pcap.

Этап 3. Эксплуатация XSS

Проведем рекон-анализ сайта Google Gruyere для поиска
потенциальных точек внедрения XSS:

Для добавления снипетов зарегистрирован пользователь. Попытка добавить <script>alert('XSS')</script> в поле снипета неудачна, возможно фильтр script.
XSS добавлена через ввод типа </img src="nonexistent.jpg" onerror="alert('XSS')">.

В итоге использован код 
</img src=x onerror="alert('test xss. Cookie: ' + document.cookie)"> 
для примера эксплуатации уязвимости. При переходе на сайт XSS срабатывает.

Этап 4. Анализ результатов
Используя скрипт, выполним анализ сохранённого .pcap-файла.
Для этого используем команду:

sudo python3 scapy_xss_analyzer.py --analyze traffic2.pcap

Добавим анализ на наличие XSS-полезных нагрузок.

Добавим поиск отраженных XSS в ответах сервера.

В ходе анализа перехваченного HTTP-трафика был обнаружен запрос, содержащий XSS-полезную нагрузку.

XSS-payload передаётся в строке запроса URL;

используется метод GET, а не POST;

полезная нагрузка присутствует в открытом виде, без шифрования, что позволяет легко обнаружить её при анализе сетевого трафика.

При анализе HTTP-ответа сервера было установлено, что XSS-полезная нагрузка отражается в ответе, что является признаком reflected XSS.

Фрагмент ответа сервера содержит ранее отправленный payload без какой-либо фильтрации или экранирования. Он располагается в HTML-теле страницы;

Обычный HTTP-запрос:
параметры содержат только текстовые данные;
в HTTP-ответе отсутствуют <script>-теги или JavaScript-код;
HTML-страница формируется корректно и не содержит пользовательского кода.

HTTP-запрос с XSS-атакой:
в параметрах запроса присутствуют HTML- и JavaScript-конструкции;
сервер возвращает эти данные в ответе без обработки;
структура HTML-ответа изменяется за счёт внедрения дополнительных тегов;
появляется возможность выполнения JavaScript-кода в браузере пользователя.


Выводы
В ходе выполнения лабораторной работы был изучен инструмент Scapy и освоены основы перехвата и анализа HTTP-трафика.
С помощью Scapy был успешно осуществлён сбор сетевого трафика при взаимодействии с учебным веб-приложением Google Gruyere.
В результате анализа HTTP-запросов и ответов было выявлено, что сервер возвращает пользовательский ввод без надлежащей фильтрации и экранирования. Это позволило внедрить и выполнить произвольный JavaScript-код в браузере пользователя, что свидетельствует о наличии уязвимости типа
межсайтовый скриптинг (XSS).
Рекомендации по устранению уязвимостей
Для предотвращения уязвимостей типа XSS в веб-приложениях рекомендуется применять следующие меры защиты:
Экранирование пользовательского ввода.
Валидация и фильтрация данных.
Использование Content Security Policy.
